<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora NN Protect - Plan de Compensación</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo } = React;
        
        const NNProtectCalculator = () => {
          const [directos, setDirectos] = useState(0);
          const [niveles, setNiveles] = useState(0);
          const [vn, setVn] = useState(0);
          const [vg, setVg] = useState(0);
          const [showDisclaimer, setShowDisclaimer] = useState(true);
          const [acceptedTerms, setAcceptedTerms] = useState(false);

          const rangos = [
            { nombre: 'Visionario', vgRequerido: 1465, unilevelNiveles: 3, infinito: 0 },
            { nombre: 'Emprendedor', vgRequerido: 21000, unilevelNiveles: 4, infinito: 0 },
            { nombre: 'Creativo', vgRequerido: 58000, unilevelNiveles: 5, infinito: 0 },
            { nombre: 'Innovador', vgRequerido: 120000, unilevelNiveles: 6, infinito: 0 },
            { nombre: 'Embajador Transformador', vgRequerido: 300000, unilevelNiveles: 9, infinito: 0.5 },
            { nombre: 'Embajador Inspirador', vgRequerido: 650000, unilevelNiveles: 9, infinito: 1.0 },
            { nombre: 'Embajador Consciente', vgRequerido: 1300000, unilevelNiveles: 9, infinito: 1.5 },
            { nombre: 'Embajador Solidario', vgRequerido: 2900000, unilevelNiveles: 9, infinito: 2.0 }
          ];

          const porcentajesUnilevel = [5, 8, 10, 10, 5, 4, 4, 3, 3];
          const porcentajesMatch = [30, 20, 10, 5];

          const calcularRango = (vgTotal) => {
            for (let i = rangos.length - 1; i >= 0; i--) {
              if (vgTotal >= rangos[i].vgRequerido) return rangos[i];
            }
            return { nombre: 'Sin Rango', vgRequerido: 0, unilevelNiveles: 0, infinito: 0 };
          };

          const calculos = useMemo(() => {
            const estructura = [];
            let vgTotalAcumulado = vg;
            
            for (let nivel = 1; nivel <= niveles; nivel++) {
              const personas = Math.pow(directos, nivel);
              estructura.push({ nivel, personas, vgNivel: personas * vg });
              vgTotalAcumulado += personas * vg;
            }

            const miRango = calcularRango(vgTotalAcumulado);
            let bonoUnilevel = 0, bonoInfinito = 0, bonoMatch = 0;
            const detalleUnilevel = [], detalleInfinito = [], detalleMatch = [];
            
            // Bono Unilevel
            for (let i = 0; i < Math.min(niveles, 9); i++) {
              const comision = estructura[i].personas * vn * (porcentajesUnilevel[i] / 100);
              bonoUnilevel += comision;
              detalleUnilevel.push({ nivel: i + 1, personas: estructura[i].personas, porcentaje: porcentajesUnilevel[i], comision });
            }

            // Bono Infinito
            if (niveles > 9 && miRango.infinito > 0) {
              const directosInfo = [];
              for (let d = 0; d < directos; d++) {
                let vgDirecto = vg;
                for (let i = 1; i < niveles; i++) vgDirecto += Math.pow(directos, i) * vg;
                directosInfo.push(calcularRango(vgDirecto));
              }
              
              for (let i = 9; i < niveles; i++) {
                let comisionNivel = 0;
                for (let d = 0; d < directos; d++) {
                  const dif = Math.max(0, miRango.infinito - directosInfo[d].infinito);
                  if (dif > 0) comisionNivel += (estructura[i].personas / directos) * vn * (dif / 100);
                }
                if (comisionNivel > 0) {
                  bonoInfinito += comisionNivel;
                  const diferenciales = {};
                  directosInfo.forEach(r => {
                    const dif = Math.max(0, miRango.infinito - r.infinito);
                    const key = `${r.nombre}-${dif}`;
                    if (!diferenciales[key]) diferenciales[key] = { rango: r.nombre, infinito: r.infinito, diferencial: dif, cantidad: 0 };
                    diferenciales[key].cantidad++;
                  });
                  detalleInfinito.push({ nivel: i + 1, personas: estructura[i].personas, miInfinito: miRango.infinito, detalleDiferenciales: Object.values(diferenciales), comision: comisionNivel });
                }
              }
            }

            // Bono Match
            const nivelesMatch = miRango.nombre === 'Embajador Transformador' ? 1 : miRango.nombre === 'Embajador Inspirador' ? 2 : miRango.nombre === 'Embajador Consciente' ? 3 : miRango.nombre === 'Embajador Solidario' ? 4 : 0;
            for (let i = 0; i < Math.min(nivelesMatch, 4, niveles); i++) {
              let vgEquipo = vg;
              for (let j = i + 1; j < niveles; j++) vgEquipo += Math.pow(directos, j - i) * vg;
              const rangoPersona = calcularRango(vgEquipo);
              let bonoUnilevelPersona = 0;
              const nivDisp = Math.min(niveles - i - 1, rangoPersona.unilevelNiveles);
              for (let k = 0; k < nivDisp && k < 9; k++) bonoUnilevelPersona += Math.pow(directos, k + 1) * vn * (porcentajesUnilevel[k] / 100);
              if (nivDisp > 9 && rangoPersona.infinito > 0) {
                for (let k = 9; k < nivDisp; k++) bonoUnilevelPersona += Math.pow(directos, k + 1) * vn * (rangoPersona.infinito / 100);
              }
              const comisionMatch = estructura[i].personas * bonoUnilevelPersona * (porcentajesMatch[i] / 100);
              bonoMatch += comisionMatch;
              detalleMatch.push({ nivel: i + 1, personas: estructura[i].personas, rangoPersona: rangoPersona.nombre, bonoUnilevelPersona, porcentajeMatch: porcentajesMatch[i], comisionMatch });
            }

            return { estructura, vgTotal: vgTotalAcumulado, miRango, bonoUnilevel, detalleUnilevel, bonoInfinito, detalleInfinito, bonoMatch, detalleMatch, totalGanancias: bonoUnilevel + bonoInfinito + bonoMatch };
          }, [directos, niveles, vn, vg]);

          if (showDisclaimer) {
            return (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div className="bg-white rounded-2xl max-w-4xl max-h-[90vh] overflow-y-auto">
                  <div className="bg-gradient-to-r from-yellow-500 to-orange-500 p-6 rounded-t-2xl">
                    <h2 className="text-3xl font-bold text-white">⚠️ AVISO LEGAL IMPORTANTE</h2>
                  </div>
                  <div className="p-8 space-y-4">
                    <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                      <p className="font-bold text-red-800">⚠️ DESCARGO DE RESPONSABILIDAD</p>
                      <p className="text-red-700 mt-2">Los resultados mostrados son PROYECCIONES TEÓRICAS únicamente. NO GARANTIZAN ganancias reales.</p>
                    </div>
                    <div className="space-y-3 text-sm text-gray-700">
                      <p><strong>1. Propósito:</strong> Herramienta de simulación con fines educativos.</p>
                      <p><strong>2. No Garantía:</strong> Los resultados reales varían por desempeño, mercado, esfuerzo y habilidades.</p>
                      <p><strong>3. Exactitud:</strong> Simplificación del plan oficial. Consulte documentación oficial de NN Protect.</p>
                      <p><strong>4. No es Asesoría:</strong> NO constituye asesoría financiera ni garantía de ganancias.</p>
                      <p><strong>5. Uso Ético:</strong> NO presente como garantías. SÍ indique que son proyecciones hipotéticas.</p>
                    </div>
                    <div className="border-t-2 pt-4">
                      <label className="flex items-start gap-3 mb-4 cursor-pointer">
                        <input type="checkbox" className="mt-1 w-5 h-5" onChange={(e) => setAcceptedTerms(e.target.checked)} />
                        <span className="text-sm font-semibold">He leído y acepto el descargo de responsabilidad.</span>
                      </label>
                      <button onClick={() => acceptedTerms && setShowDisclaimer(false)} disabled={!acceptedTerms} className="w-full bg-green-600 text-white font-bold py-3 rounded-xl disabled:opacity-50">
                        Acepto y Continuar
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-900 via-blue-800 to-blue-900 p-6">
              <div className="max-w-7xl mx-auto">
                <h1 className="text-4xl font-bold text-white text-center mb-2">Calculadora NN Protect</h1>
                <p className="text-blue-200 text-center mb-8">Plan de Compensación - Simulador de Ganancias</p>

                <div className="bg-white rounded-xl shadow-2xl p-6 mb-6">
                  <h2 className="text-2xl font-bold mb-4">Parámetros de Simulación</h2>
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                    {[
                      { label: 'Directos (Nivel 1)', value: directos, setter: setDirectos, min: 1, max: 20 },
                      { label: 'Niveles de Profundidad', value: niveles, setter: setNiveles, min: 1 },
                      { label: 'VN por Miembro', value: vn, setter: setVn, min: 0 },
                      { label: 'VG por Miembro', value: vg, setter: setVg, min: 0 }
                    ].map((field, idx) => (
                      <div key={idx}>
                        <label className="block text-sm font-semibold mb-2">{field.label}</label>
                        <input type="number" min={field.min} max={field.max} value={field.value} onChange={(e) => field.setter(parseInt(e.target.value) || 0)} className="w-full px-4 py-3 border-2 rounded-lg text-lg font-semibold" />
                      </div>
                    ))}
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                  <div className="bg-blue-600 rounded-xl p-6 text-white">
                    <h3 className="font-semibold mb-2">Total Equipo</h3>
                    <p className="text-4xl font-bold">{calculos.estructura.reduce((s, n) => s + n.personas, 0).toLocaleString()}</p>
                  </div>
                  <div className="bg-purple-600 rounded-xl p-6 text-white">
                    <h3 className="font-semibold mb-2">Volumen Total (VG)</h3>
                    <p className="text-4xl font-bold">{calculos.vgTotal.toLocaleString()}</p>
                  </div>
                  <div className="bg-orange-500 rounded-xl p-6 text-white">
                    <h3 className="font-semibold mb-2">Tu Rango</h3>
                    <p className="text-3xl font-bold">{calculos.miRango.nombre}</p>
                  </div>
                </div>

                <div className="bg-green-600 rounded-xl p-8 mb-6 text-white text-center">
                  <h2 className="text-3xl font-bold mb-2">💰 GANANCIAS TOTALES</h2>
                  <p className="text-6xl font-bold mb-4">${calculos.totalGanancias.toLocaleString(undefined, {minimumFractionDigits: 2})}</p>
                  <div className="flex justify-center gap-8 text-sm">
                    <div><p>Bono Unilevel</p><p className="text-xl font-bold">${calculos.bonoUnilevel.toLocaleString(undefined, {minimumFractionDigits: 2})}</p></div>
                    <div><p>Bono Infinito</p><p className="text-xl font-bold">${calculos.bonoInfinito.toLocaleString(undefined, {minimumFractionDigits: 2})}</p></div>
                    <div><p>Bono Match</p><p className="text-xl font-bold">${calculos.bonoMatch.toLocaleString(undefined, {minimumFractionDigits: 2})}</p></div>
                  </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                  <div className="bg-white rounded-xl p-6">
                    <h3 className="text-xl font-bold mb-4 border-b-2 pb-2">📊 Bono Unilevel (1-9)</h3>
                    <div className="space-y-2 max-h-96 overflow-y-auto">
                      {calculos.detalleUnilevel.map(d => (
                        <div key={d.nivel} className="flex justify-between bg-blue-50 p-3 rounded">
                          <span className="font-semibold">Nivel {d.nivel} ({d.personas.toLocaleString()})</span>
                          <span className="font-bold text-blue-600">${d.comision.toLocaleString(undefined, {minimumFractionDigits: 2})}</span>
                        </div>
                      ))}
                    </div>
                    <div className="mt-4 pt-4 border-t-2 flex justify-between">
                      <span className="font-bold">Total:</span>
                      <span className="font-bold text-2xl text-blue-600">${calculos.bonoUnilevel.toLocaleString(undefined, {minimumFractionDigits: 2})}</span>
                    </div>
                  </div>

                  <div className="bg-white rounded-xl p-6">
                    <h3 className="text-xl font-bold mb-4 border-b-2 pb-2">♾️ Bono Infinito (10+)</h3>
                    {calculos.detalleInfinito.length > 0 ? (
                      <>
                        <div className="space-y-2 max-h-96 overflow-y-auto">
                          {calculos.detalleInfinito.map(d => (
                            <div key={d.nivel} className="bg-purple-50 p-3 rounded">
                              <div className="flex justify-between mb-2">
                                <span className="font-semibold">Nivel {d.nivel} ({d.personas.toLocaleString()})</span>
                                <span className="font-bold text-purple-600">${d.comision.toLocaleString(undefined, {minimumFractionDigits: 2})}</span>
                              </div>
                              <div className="text-xs">
                                <p className="font-semibold">Breakaway:</p>
                                {d.detalleDiferenciales.map((dif, i) => (
                                  <div key={i} className="pl-2">{dif.rango} ({dif.cantidad}x): {d.miInfinito}% - {dif.infinito}% = <span className="font-bold">{dif.diferencial}%</span></div>
                                ))}
                              </div>
                            </div>
                          ))}
                        </div>
                        <div className="mt-4 pt-4 border-t-2 flex justify-between">
                          <span className="font-bold">Total:</span>
                          <span className="font-bold text-2xl text-purple-600">${calculos.bonoInfinito.toLocaleString(undefined, {minimumFractionDigits: 2})}</span>
                        </div>
                      </>
                    ) : (
                      <p className="text-gray-500 text-center py-8">{niveles <= 9 ? 'Necesitas más de 9 niveles' : 'Necesitas rango Embajador'}</p>
                    )}
                  </div>

                  <div className="bg-white rounded-xl p-6 lg:col-span-2">
                    <h3 className="text-xl font-bold mb-4 border-b-2 pb-2">🤝 Bono Match</h3>
                    {calculos.detalleMatch.length > 0 ? (
                      <>
                        <div className="space-y-3 max-h-96 overflow-y-auto">
                          {calculos.detalleMatch.map(d => (
                            <div key={d.nivel} className="bg-green-50 p-4 rounded">
                              <div className="flex justify-between mb-2">
                                <span className="font-semibold">Nivel {d.nivel} ({d.personas.toLocaleString()})</span>
                                <span className="font-bold text-xl text-green-600">${d.comisionMatch.toLocaleString(undefined, {minimumFractionDigits: 2})}</span>
                              </div>
                              <div className="text-sm flex justify-between bg-white p-2 rounded">
                                <span>Rango: <strong>{d.rangoPersona}</strong></span>
                                <span>Unilevel c/u: <strong>${d.bonoUnilevelPersona.toLocaleString(undefined, {minimumFractionDigits: 2})}</strong></span>
                              </div>
                            </div>
                          ))}
                        </div>
                        <div className="mt-4 pt-4 border-t-2 flex justify-between">
                          <span className="font-bold">Total:</span>
                          <span className="font-bold text-2xl text-green-600">${calculos.bonoMatch.toLocaleString(undefined, {minimumFractionDigits: 2})}</span>
                        </div>
                      </>
                    ) : (
                      <p className="text-gray-500 text-center py-8">Necesitas rango Embajador Transformador o superior</p>
                    )}
                  </div>
                </div>

                <div className="bg-white rounded-xl p-6">
                  <h3 className="text-xl font-bold mb-4 border-b-2 pb-2">👥 Estructura del Equipo</h3>
                  <div className="overflow-x-auto">
                    <table className="w-full">
                      <thead className="bg-blue-100">
                        <tr>
                          <th className="px-4 py-3 text-left">Nivel</th>
                          <th className="px-4 py-3 text-right">Personas</th>
                          <th className="px-4 py-3 text-right">VG Nivel</th>
                          <th className="px-4 py-3 text-right">VG Acum.</th>
                        </tr>
                      </thead>
                      <tbody>
                        {calculos.estructura.map((e, i) => {
                          const vgAcum = calculos.estructura.slice(0, i + 1).reduce((s, x) => s + x.vgNivel, 0);
                          return (
                            <tr key={e.nivel} className="border-b hover:bg-gray-50">
                              <td className="px-4 py-3 font-semibold">{e.nivel}</td>
                              <td className="px-4 py-3 text-right">{e.personas.toLocaleString()}</td>
                              <td className="px-4 py-3 text-right">{e.vgNivel.toLocaleString()}</td>
                              <td className="px-4 py-3 text-right font-semibold text-blue-600">{vgAcum.toLocaleString()}</td>
                            </tr>
                          );
                        })}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        ReactDOM.render(<NNProtectCalculator />, document.getElementById('root'));
    </script>
</body>
</html>